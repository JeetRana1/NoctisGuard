<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoctisGuard - Moderation & Utilities Bot</title>
  <!-- Removed external Google Fonts to avoid network DNS errors; using system fonts -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/favicon.svg" sizes="any">
  <link rel="shortcut icon" href="/favicon.svg">
  <link rel="apple-touch-icon" href="/favicon.svg">
</head>

<body>
  <!-- Page loader overlay (visible while site is loading) -->
  <div id="page-loader" class="page-loader" aria-hidden="false">
    <div class="spinner" aria-hidden="true"></div>
  </div>

  <header>
    <nav class="container">
      <div class="logo">
        <img src="Site-Logo.svg" alt="NoctisGuard Logo" class="logo-img">
        <span>NoctisGuard</span>
      </div>
      <ul class="nav-links">
        <li><a href="#features">Features</a></li>
        <li><a href="#team">Team</a></li>
        <li><a href="#invite">Invite</a></li>
      </ul>
      <div class="auth-buttons">
        <a id="nav-invite" href="/invite-now" class="btn ghost small">Invite</a>
        <a id="nav-login" href="javascript:login()" class="btn primary small">Login with Discord</a>
      </div>
    </nav>
  </header>

  <section class="hero container reveal">
    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title gradient-text">NoctisGuard — Smart moderation, effortless control</h1>
        <p class="hero-subtitle">Keep your community safe with automated moderation, clear logs, and an intuitive
          dashboard built for server owners.</p>
        <div class="hero-ctas">
          <a id="hero-invite" href="/invite-now" class="btn primary large">Invite Now</a>
          <a id="hero-dashboard" href="/dashboard" class="btn ghost large">Dashboard</a>
        </div>
        <div class="trust-badges">
          <span>Trusted by communities of all sizes</span>
          <span class="dot">•</span>
          <span>Lightweight</span>
          <span class="dot">•</span>
          <span>Privacy-first</span>
        </div>
      </div>
      <!-- Hero Stat Card Preview -->
      <div class="hero-preview reveal">
        <div class="stat-card dashboard-preview">
          <div class="preview-header">
            <h3>Dashboard Preview</h3>
          </div>
          <div class="preview-stats">
            <div class="p-stat">
              <span id="stat-servers" class="p-val">0</span>
              <span class="p-label">Servers</span>
            </div>
            <div class="p-stat">
              <span id="stat-members" class="p-val">0</span>
              <span class="p-label">Total Members</span>
            </div>
            <div class="p-stat">
              <div class="sparkline-wrap">
                <span id="stat-commands" class="p-val">0</span>
                <svg id="stat-sparkline" viewBox="0 0 100 22" preserveAspectRatio="none">
                  <polyline points="0,22 20,18 40,20 60,10 80,12 100,2" fill="none" stroke="var(--accent)"
                    stroke-width="2" vector-effect="non-scaling-stroke"></polyline>
                </svg>
              </div>
              <span class="p-label">Commands Today</span>
            </div>
            <div class="p-stat">
              <span id="stat-uptime" class="p-val">0</span>
              <span class="p-label">Uptime (hrs)</span>
            </div>
          </div>
          <div class="preview-footer">
            <span id="stats-last-updated" class="small-muted">Updated: —</span>
            <button id="stats-refresh" class="btn small ghost">Refresh</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="features" class="features container">
    <h2 class="section-title reveal">Features</h2>
    <p class="section-lead reveal">Powerful tools built with simplicity and safety in mind.</p>

    <div class="features-grid">
      <div class="feature-card reveal">
        <div class="feature-icon mod-icon"></div>
        <h3>Moderation</h3>
        <p>Ban, kick, mute, and keep detailed logs with robust permission checks and quick actions.</p>
      </div>
      <div class="feature-card reveal">
        <div class="feature-icon automod-icon"></div>
        <h3>Automod</h3>
        <p>Proactive filters for profanity, spam, invites and more — configurable per server.</p>
      </div>
      <div class="feature-card reveal">
        <div class="feature-icon dashboard-icon"></div>
        <h3>Web Dashboard</h3>
        <p>Manage your bot settings, view analytics, and control plugins from a beautiful interface.</p>
      </div>
    </div>
  </section>

  <section id="team" class="team container">
    <h2 class="section-title">Meet the Team</h2>
    <div class="card team-wrap reveal">
      <div class="team-grid">
        <div class="team-member card reveal">
          <img src="Profile-Pic.svg" alt="Developer" class="team-avatar">
          <h3>Developer</h3>
          <p>Lead Developer & Maintainer</p>
        </div>
      </div>
    </div>
  </section>

  <section id="invite" class="invite container">
    <h2 class="section-title">Ready to upgrade your server?</h2>
    <p class="section-lead">Invite NoctisGuard today and get access to robust moderation tools and a clean dashboard —
      for free.</p>
    <div class="invite-ctas reveal">
      <a id="invite-bottom" href="/invite-now" class="btn primary large">Invite NoctisGuard</a>
      <a id="login-bottom" href="javascript:login()" class="btn ghost large">Login with Discord</a>
    </div>
  </section>

  <footer class="container">
    <div class="footer-wrap">
      <div class="footer-left">
        <div class="logo">
          <img src="Site-Logo.svg" alt="NoctisGuard Logo" class="logo-img">
          <span>NoctisGuard</span>
        </div>
        <p class="small-muted">© 2026 NoctisGuard. Not affiliated with Discord Inc.</p>
      </div>
      <div class="footer-links">
        <a href="https://github.com/noctisguard" target="_blank" rel="noopener noreferrer">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
          </svg>
          GitHub
        </a>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    (function () {
      // Consolidate Socket.IO loading and stats fetching
      const s = document.createElement('script');
      s.src = 'https://cdn.socket.io/4.7.2/socket.io.min.js';
      s.async = true;
      s.crossOrigin = 'anonymous';
      document.head.appendChild(s);

      // Sparkline renderer
      function renderSparkline(points) {
        try {
          if (!points || !points.length) { document.querySelector('#stat-sparkline polyline').setAttribute('points', ''); return; }
          const values = points.map(p => Number(p.v) || 0);
          const max = Math.max.apply(null, values);
          const min = Math.min.apply(null, values);
          const w = 100, h = 22; const len = values.length;
          const pad = 4; const innerW = w - pad * 2; const innerH = h - pad * 2;
          const pts = values.map((v, i) => {
            const x = pad + (i / (Math.max(1, len - 1))) * innerW;
            const y = pad + (max === min ? innerH / 2 : (1 - (v - min) / (max - min)) * innerH);
            return x.toFixed(2) + ',' + y.toFixed(2);
          }).join(' ');
          document.querySelector('#stat-sparkline polyline').setAttribute('points', pts);
        } catch (e) { }
      }

      // Main stats fetcher
      async function fetchAndRenderStats() {
        try {
          const res = await fetch('/api/stats');
          if (!res.ok) return;
          const jb = await res.json();
          const fmt = (n) => { if (n === null || typeof n === 'undefined') return '—'; if (typeof n === 'number') return n.toLocaleString(); return String(n); };

          document.getElementById('stat-servers').textContent = (typeof jb.guildCount === 'number') ? fmt(jb.guildCount) : '0';
          document.getElementById('stat-members').textContent = (typeof jb.totalMembers === 'number') ? fmt(jb.totalMembers) : '0';
          document.getElementById('stat-commands').textContent = (typeof jb.commandsToday === 'number') ? fmt(jb.commandsToday) : '0';
          document.getElementById('stat-uptime').textContent = (typeof jb.uptimeHours === 'number') ? String(jb.uptimeHours) : '—';

          if (jb.lastUpdated) document.getElementById('stats-last-updated').textContent = 'Updated: ' + new Date(jb.lastUpdated).toLocaleString();
          if (jb.history && jb.history.length) renderSparkline(jb.history);
        } catch (e) { console.error('fetch stats error', e); }
      }

      // Initial load
      fetchAndRenderStats();
      setInterval(fetchAndRenderStats, 30000);

      const refreshBtn = document.getElementById('stats-refresh');
      if (refreshBtn) refreshBtn.addEventListener('click', fetchAndRenderStats);

      // Socket.IO updates
      function setupSocket() {
        try {
          const socket = io();
          socket.on('bot-stats', (payload) => {
            const jb = payload.stats || payload;
            const fmt = (n) => { if (n === null || typeof n === 'undefined') return '—'; if (typeof n === 'number') return n.toLocaleString(); return String(n); };
            if (jb.guildCount !== undefined) document.getElementById('stat-servers').textContent = fmt(jb.guildCount);
            if (jb.totalMembers !== undefined) document.getElementById('stat-members').textContent = fmt(jb.totalMembers);
            if (jb.commandsToday !== undefined) document.getElementById('stat-commands').textContent = fmt(jb.commandsToday);
            if (jb.uptimeHours !== undefined) document.getElementById('stat-uptime').textContent = String(jb.uptimeHours);
            if (jb.lastUpdated) document.getElementById('stats-last-updated').textContent = 'Updated: ' + new Date(jb.lastUpdated).toLocaleString();
          });
          socket.on('bot-stats-history', (payload) => renderSparkline(payload.history || []));
        } catch (e) { }
      }

      function tryConnect(retries) {
        if (typeof io !== 'undefined') { setupSocket(); return; }
        if (retries > 0) setTimeout(() => tryConnect(retries - 1), 500);
      }
      tryConnect(10);
    })();
  </script>
</body>

</html>